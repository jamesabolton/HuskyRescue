(function(n,t){"use strict";var c=t.ea,u={settings:{debug:!1,dependencyTriggers:"change keyup",apply:function(t){function r(){if(!i.isBool(u.settings.debug))throw"debug value must be a boolean (true or false)";if(!i.isString(u.settings.dependencyTriggers)&&u.settings.dependencyTriggers!==null&&u.settings.dependencyTriggers!==undefined)throw"dependencyTriggers value must be a string (multiple event types can be bound at once by including each one separated by a space), null or undefined";}function f(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])}f(u.settings,t);r();n("form").each(function(){n(this).find("input, select, textarea").off(".expressive.annotations");e.bindFields(this,!0)})}},addMethod:function(n,t){s.addMethod(n,t)},addValueParser:function(n,t){i.addValueParser(n,t)},noConflict:function(){return t.ea===this&&(t.ea=c),this}},r={dump:function(n){u.settings.debug&&console&&typeof console.log=="function"&&console.log(n)},warn:function(n){console&&typeof console.warn=="function"&&console.warn(n)},fail:function(n){console&&typeof console.error=="function"&&console.error(n)}},s={methods:{},addMethod:function(n,t){var i=this.methods[n];this.methods[n]=function(){return t.length===arguments.length?t.apply(this,arguments):typeof i=="function"?i.apply(this,arguments):void 0}},registerMethods:function(n){var t,i;this.initialize();for(t in this.methods)this.methods.hasOwnProperty(t)&&(i=this.methods[t],n[t]=i)},initialize:function(){this.addMethod("Now",function(){return Date.now()});this.addMethod("Today",function(){return new Date((new Date).setHours(0,0,0,0)).getTime()});this.addMethod("Date",function(n,t,i){return new Date(new Date(n,t-1,i).setFullYear(n)).getTime()});this.addMethod("Date",function(n,t,i,r,u,f){return new Date(new Date(n,t-1,i,r,u,f).setFullYear(n)).getTime()});this.addMethod("TimeSpan",function(n,t,i,r){return r*1e3+i*6e4+t*36e5+n*864e5});this.addMethod("Length",function(n){return n!==null&&n!==undefined?n.length:0});this.addMethod("Trim",function(t){return t!==null&&t!==undefined?n.trim(t):null});this.addMethod("Concat",function(n,t){return[n,t].join("")});this.addMethod("Concat",function(n,t,i){return[n,t,i].join("")});this.addMethod("CompareOrdinal",function(n,t){return n===t?0:n!==null&&t===null?1:n===null&&t!==null?-1:n>t?1:-1});this.addMethod("CompareOrdinalIgnoreCase",function(n,t){return n=n!==null&&n!==undefined?n.toLowerCase():null,t=t!==null&&t!==undefined?t.toLowerCase():null,this.CompareOrdinal(n,t)});this.addMethod("StartsWith",function(n,t){return n!==null&&n!==undefined&&t!==null&&t!==undefined&&n.slice(0,t.length)===t});this.addMethod("StartsWithIgnoreCase",function(n,t){return n=n!==null&&n!==undefined?n.toLowerCase():null,t=t!==null&&t!==undefined?t.toLowerCase():null,this.StartsWith(n,t)});this.addMethod("EndsWith",function(n,t){return n!==null&&n!==undefined&&t!==null&&t!==undefined&&n.slice(-t.length)===t});this.addMethod("EndsWithIgnoreCase",function(n,t){return n=n!==null&&n!==undefined?n.toLowerCase():null,t=t!==null&&t!==undefined?t.toLowerCase():null,this.EndsWith(n,t)});this.addMethod("Contains",function(n,t){return n!==null&&n!==undefined&&t!==null&&t!==undefined&&n.indexOf(t)>-1});this.addMethod("ContainsIgnoreCase",function(n,t){return n=n!==null&&n!==undefined?n.toLowerCase():null,t=t!==null&&t!==undefined?t.toLowerCase():null,this.Contains(n,t)});this.addMethod("IsNullOrWhiteSpace",function(n){return n===null||!/\S/.test(n)});this.addMethod("IsDigitChain",function(n){return/^[0-9]+$/.test(n)});this.addMethod("IsNumber",function(n){return/^[+-]?(?:(?:[0-9]+)|(?:[0-9]+[eE][+-]?[0-9]+)|(?:[0-9]*\.[0-9]+(?:[eE][+-]?[0-9]+)?))$/.test(n)});this.addMethod("IsEmail",function(n){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(n)});this.addMethod("IsUrl",function(n){return/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/i.test(n)});this.addMethod("IsRegexMatch",function(n,t){return n!==null&&n!==undefined&&t!==null&&t!==undefined&&new RegExp(t).test(n)});this.addMethod("Guid",function(n){var t=i.guid.tryParse(n);if(t.error)throw t.msg;return t})}},i={parsers:{},addValueParser:function(t,r){n.each(t.split(/\s+/),function(n,t){/\S/.test(t)&&(i.parsers[t]=r)})},array:{contains:function(n,t){for(var i=n.length;i--;)if(n[i]===t)return!0;return!1}},object:{keys:function(n){var t,i=[];for(t in n)n.hasOwnProperty(t)&&i.push(t);return i},tryParse:function(t){try{return n.parseJSON(t)}catch(i){return{error:!0,msg:"Given value was not recognized as a valid JSON. "+i}}}},string:{format:function(n,t){function u(n){return n=i.isObject(n)?JSON.stringify(n,null,4):n,i.isString(n)?n.replace(/\$/g,"$$$$"):n}function f(n,t,i){return n.replace(new RegExp("\\{"+i+"\\}","gm"),t)}var r;if(t instanceof Array){for(r=0;r<t.length;r++)n=f(n,u(t[r]),r);return n}for(r=0;r<arguments.length-1;r++)n=f(n,u(arguments[r+1]),r);return n},tryParse:function(n){return i.isString(n)?n:n!==undefined&&n!==null?n.toString():{error:!0,msg:"Given value was not recognized as a valid string."}}},bool:{tryParse:function(t){return i.isBool(t)?t:i.isString(t)&&(t=n.trim(t).toLowerCase(),t==="true"||t==="false")?t==="true":{error:!0,msg:"Given value was not recognized as a valid boolean."}}},number:{tryParse:function(n){function t(n){return i.isNumeric(parseFloat(n))&&isFinite(n)}return t(n)?parseFloat(n):{error:!0,msg:"Given value was not recognized as a valid float."}}},timespan:{tryParse:function(n){if(i.isTimeSpan(n)){var t=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/.exec(n),r=t[1]==="-"?-1:1,u={days:i.number.tryParse(t[2]||0)*r,hours:i.number.tryParse(t[3]||0)*r,minutes:i.number.tryParse(t[4]||0)*r,seconds:i.number.tryParse(t[5]||0)*r,milliseconds:i.number.tryParse(t[6]||0)*r};return u.milliseconds+u.seconds*1e3+u.minutes*6e4+u.hours*36e5+u.days*864e5}return{error:!0,msg:"Given value was not recognized as a valid .NET style timespan string."}}},date:{tryParse:function(n){if(i.isDate(n))return n.getTime();if(i.isString(n)){var t=Date.parse(n);if(i.isNumeric(t))return t}return{error:!0,msg:"Given value was not recognized as a valid RFC 2822 or ISO 8601 date."}}},guid:{tryParse:function(n){return i.isGuid(n)?n.toUpperCase():{error:!0,msg:"Given value was not recognized as a valid guid - guid should contain 32 digits with 4 dashes (xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx)."}}},isTimeSpan:function(n){return/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/.test(n)},isNumeric:function(n){return typeof n=="number"&&!isNaN(n)},isDate:function(n){return n instanceof Date},isObject:function(n){return typeof n=="object"||n instanceof Object},isString:function(n){return typeof n=="string"||n instanceof String},isBool:function(n){return typeof n=="boolean"||n instanceof Boolean},isGuid:function(n){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(n)},tryParse:function(n,t,u,f){var e;if(f!==null&&f!==undefined){if(e=i.findValueParser(u,f),!e.error)return e(n,u);r.warn(e.msg)}return(e=i.findValueParser(u,t),!e.error)?(r.warn(i.string.format("Overriden {0} type parsing runs for {1} field. All fields of {0} type are going to be parsed using your value parser. If such a behavior is unintentional, change the name of your value parser to one, which does not indicate at {0} (or any other) type name.",t,u)),e(n,u)):i.tryAutoParse(n,t)},tryAutoParse:function(n,t){switch(t){case"timespan":return i.timespan.tryParse(n);case"datetime":return i.date.tryParse(n);case"numeric":return i.number.tryParse(n);case"string":return i.string.tryParse(n);case"bool":return i.bool.tryParse(n);case"guid":return i.guid.tryParse(n);default:return i.object.tryParse(n)}},findValueParser:function(n,t){var r=i.parsers[t];return typeof r=="function"?r:{error:!0,msg:i.string.format("Custom value parser {0} not found. Consider its registration with ea.addValueParser(), or remove redundant ValueParser attribute from {1} model field.",t,n)}}},f={getPrefix:function(n){return n.substr(0,n.lastIndexOf(".")+1)},extractValue:function(t,u,f,e,o){function a(n){var t=n.attr("type");switch(t){case"checkbox":return n.length>2&&r.warn(i.string.format("DOM field {0} is ambiguous (unless custom value parser is provided).",n.attr("name"))),n.is(":checked");case"radio":return n.filter(":checked").val();default:return n.length>1&&r.warn(i.string.format("DOM field {0} is ambiguous (unless custom value parser is provided).",n.attr("name"))),n.val()}}var l,h,c,s;if(h=f+u,l=n(t).find(i.string.format(':input[name="{0}"]',h)),l.length===0)throw i.string.format("DOM field {0} not found.",h);if(c=a(l),c===null||c===undefined||c==="")return null;if(s=i.tryParse(c,e,h,o),s!==null&&s!==undefined&&s.error)throw i.string.format("DOM field {0} value conversion to {1} failed. {2}",h,e,s.msg);return s},deserializeObject:function(n,t,i,r,u){function s(n,t,i){var u,r,f,e,o;for(u=n.split("."),r=i,f=0;f<u.length-1;f++){if(n=u[f],e=/^([a-z_0-9]+)\[([0-9]+)\]$/i.exec(n),e){n=e[1];o=e[2];r.hasOwnProperty(n)||(r[n]={});r[n][o]={};r=r[n][o];continue}r.hasOwnProperty(n)||(r[n]={});r=r[n]}n=u[u.length-1];r[n]=t}var o={},f,h,e,c;for(f in t)t.hasOwnProperty(f)&&(h=t[f],c=r[f],e=this.extractValue(n,f,u,h,c),s(f,e,o));for(f in i)i.hasOwnProperty(f)&&(e=i[f],s(f,e,o));return o},adjustGivenValue:function(n,t,u){var o,f,e;if(n=t.type==="checkbox"?t.checked:n,o=t.name.replace(u.prefix,""),f=u.parsersMap[o],f!==null&&f!==undefined){if(e=i.findValueParser(t.name,f),!e.error)return e(n,t.name);r.warn(e.msg)}return n},ctxEval:function(n,t){return new Function("expression","context","with(context){return eval(expression)}")(n,t)}},e={referencesMap:[],collectReferences:function(n,t,r){for(var u,f=0;f<n.length;f++)u=r+n[f],u!==t&&(this.referencesMap[u]=this.referencesMap[u]||[],i.array.contains(this.referencesMap[u],t)||this.referencesMap[u].push(t))},validateReferences:function(t,u){var e,o,f;if(f=this.referencesMap[t],f!==undefined&&f!==null)for(r.dump(i.string.format("Validation triggered for following {0} dependencies: {1}.",t,f.join(", "))),e=f.length;e--;)o=n(u).find(i.string.format(':input[data-val][name="{0}"]',f[e])),o.length!==0&&o.valid();else r.dump(i.string.format("No dependencies of {0} field detected.",t))},bindFields:function(t,f){if(u.settings.dependencyTriggers!==null&&u.settings.dependencyTriggers!==undefined&&u.settings.dependencyTriggers!==""){var o=[];n.each(u.settings.dependencyTriggers.split(/\s+/),function(n,t){/\S/.test(t)&&o.push(i.string.format("{0}.expressive.annotations",t))});n(t).find("input, select, textarea").not(function(t,i){var r=n(i).hasClass("ea-triggers-bound");return n(i).addClass("ea-triggers-bound"),!f&&r}).on(o.join(" "),function(u){var f=n(this).attr("name");r.dump(i.string.format("Dependency validation trigger - {0} event, handled.",u.type));e.validateReferences(f,t)})}}},h=function(t,r){var u={prefix:f.getPrefix(r.element.name),form:r.form};for(var o in r.params)r.params.hasOwnProperty(o)&&(u[o]=r.params[o]!==undefined?n.parseJSON(r.params[o]):{});r.message&&(r.messages[t]=function(n){var t,i,u,e,o;t=r.message;for(i in n.errFieldsMap)n.errFieldsMap.hasOwnProperty(i)&&(u=n.errFieldsMap[i],e=f.extractValue(n.form,i,n.prefix,"string",null),o=new RegExp(u,"g"),t=t.replace(o,e));return t});e.bindFields(r.form);e.collectReferences(i.object.keys(u.fieldsMap),r.element.name,u.prefix);r.rules[t]=u},l=function(n,t,u){if(n=f.adjustGivenValue(n,t,u),!(n===undefined||n===null||n==="")){var e=f.deserializeObject(u.form,u.fieldsMap,u.constsMap,u.parsersMap,u.prefix);if(s.registerMethods(e),r.dump(i.string.format("AssertThat expression of {0} field:\n{1}\nwill be executed within following context (methods hidden):\n{2}",t.name,u.expression,e)),!f.ctxEval(u.expression,e))return!1}return!0},a=function(n,t,u){if(n=f.adjustGivenValue(n,t,u),n===undefined||n===null||n===""||!/\S/.test(n)&&!u.allowEmpty){var e=f.deserializeObject(u.form,u.fieldsMap,u.constsMap,u.parsersMap,u.prefix);if(s.registerMethods(e),r.dump(i.string.format("RequiredIf expression of {0} field:\n{1}\nwill be executed within following context (methods hidden):\n{2}",t.name,u.expression,e)),f.ctxEval(u.expression,e))return!1}return!0},o=" abcdefghijklmnopqrstuvwxyz";n.each(o.split(""),function(){var t=i.string.format("assertthat{0}",n.trim(this));n.validator.unobtrusive.adapters.add(t,["expression","fieldsMap","constsMap","parsersMap","errFieldsMap"],function(n){h(t,n)})});n.each(o.split(""),function(){var t=i.string.format("requiredif{0}",n.trim(this));n.validator.unobtrusive.adapters.add(t,["expression","fieldsMap","constsMap","parsersMap","errFieldsMap","allowEmpty"],function(n){h(t,n)})});n.each(o.split(""),function(){var t=i.string.format("assertthat{0}",n.trim(this));n.validator.addMethod(t,function(n,t,i){try{return l(n,t,i)}catch(u){r.fail(u)}},"")});n.each(o.split(""),function(){var t=i.string.format("requiredif{0}",n.trim(this));n.validator.addMethod(t,function(n,t,i){try{return a(n,t,i)}catch(u){r.fail(u)}},"")});t.ea=u})(jQuery,window);
//# sourceMappingURL=expressive.annotations.validate.min.js.map
